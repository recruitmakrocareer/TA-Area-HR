<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HR Recruitment Workspace</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- SheetJS for Excel/CSV Parsing and Export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #F8FAFC; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Custom Select for Badges */
    .status-select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.4rem center;
      background-size: 1em;
      padding-right: 1.6rem;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React Code -->
  <script type="text/babel" data-type="module">
    import React, { useState, useMemo, useEffect } from 'https://esm.sh/react@18.2.0';
    import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
    import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell } from 'https://esm.sh/recharts@2.12.0?deps=react@18.2.0,react-dom@18.2.0';
    import { Users, UserPlus, BarChart3, Building2, CheckCircle2, Clock, MapPin, Search, AlertCircle, FileText, Briefcase, Phone, MessageSquare, Map, Target, Edit, Trash2, X, BellRing, Download, Paperclip, Upload, Eye, PlusCircle, Settings, Check } from 'https://esm.sh/lucide-react@0.344.0?deps=react@18.2.0';

    // ==========================================
    // ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GOOGLE SHEETS API
    // ==========================================
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzM4EXsW141-nqY7rRwU_MFc9vnrJSbK-8Wdwn-ZJwvfEBlNMZJH2dhE0r2C4uJf7mnxg/exec"; 

    // --- MOCK DATA ---
    const DEFAULT_TAS = ['TA 1 (‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠)', 'TA 2 (‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏µ)', 'TA 3 (‡∏Ñ‡∏∏‡∏ì‡∏ã‡∏µ)', 'TA 4 (‡∏Ñ‡∏∏‡∏ì‡∏î‡∏µ)'];
    const DEFAULT_POSITIONS = [
      { position: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏Ç‡∏≤', recruit: '', area: '' },
      { position: '‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏Ç‡∏≤', recruit: '', area: '' },
      { position: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢', recruit: '', area: '' },
      { position: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏Ñ‡∏ä‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå', recruit: '', area: '' },
      { position: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', recruit: '', area: '' },
      { position: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£', recruit: '', area: '' },
      { position: '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', recruit: '', area: '' }
    ];

    const DEFAULT_BRANCHES = [
      { code: '001', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß', area: 'Area 5' },
      { code: '002', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏∞', area: 'Area 10' },
      { code: '003', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏®‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå', area: 'Area 11' },
      { code: '004', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô', area: 'Area 1' },
      { code: '005', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ', area: 'Area 9' },
      { code: '006', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 1 (‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà)', area: 'Area 6' },
      { code: '007', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤', area: 'Area 2' },
      { code: '008', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏£‡∏±‡∏á‡∏™‡∏¥‡∏ï', area: 'Area 11' },
      { code: '009', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà', area: 'Area 4' },
      { code: '010', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ', area: 'Area 7' },
      { code: '011', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å', area: 'Area 2' },
      { code: '012', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô', area: 'Area 7' },
      { code: '013', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏è‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ', area: 'Area 4' },
      { code: '014', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ', area: 'Area 8' },
      { code: '015', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏£‡∏∞‡∏¢‡∏≠‡∏á', area: 'Area 14' },
      { code: '016', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå', area: 'Area 2' },
      { code: '017', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏£‡∏±‡∏ç‡∏™‡∏ô‡∏¥‡∏ó‡∏ß‡∏á‡∏®‡πå', area: 'Area 10' },
      { code: '018', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏≤‡∏ó‡∏£', area: 'Area 13' },
      { code: '019', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°', area: 'Area 5' },
      { code: '020', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå', area: 'Area 8' },
      { code: '021', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏≤‡∏°‡πÄ‡∏™‡∏ô', area: 'Area 13' },
      { code: '022', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä', area: 'Area 4' },
      { code: '023', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢', area: 'Area 6' },
      { code: '122', name: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏≠‡∏∏‡∏ó‡∏¥‡∏®', area: 'Area 3' }
    ];

    const STATUSES = ['‡∏£‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå', '‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå', '‡∏ú‡πà‡∏≤‡∏ô', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', '‡∏™‡∏≥‡∏£‡∏≠‡∏á', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô', '‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô', '‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'];
    const VACANCY_STATUSES = ['Vacant', 'Promote&Transfer', 'Hold', 'Closed'];

    const STATUS_COLORS = { '‡∏£‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå': '#F59E0B', '‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå': '#64748B', '‡∏ú‡πà‡∏≤‡∏ô': '#10B981', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô': '#EF4444', '‡∏™‡∏≥‡∏£‡∏≠‡∏á': '#3B82F6', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û': '#8B5CF6', '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô': '#0EA5E9', '‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô': '#059669', '‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô': '#94A3B8', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': '#F97316' };
    const VACANCY_COLORS = { 'Vacant': '#F59E0B', 'Promote&Transfer': '#8B5CF6', 'Hold': '#64748B', 'Closed': '#94A3B8', '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û': '#0EA5E9', '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô': '#0EA5E9', 'Hiring': '#10B981' };

    // --- HELPER FUNCTION: ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Date ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤ Google Sheets ‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∞‡πÑ‡∏£ ---
    const parseDateToMs = (val) => {
      if (!val) return null;
      
      // 1. ‡∏•‡∏≠‡∏á‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥ (‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡πá‡∏ô Timestamp ‡πÅ‡∏•‡πâ‡∏ß Google ‡πÅ‡∏≠‡∏ö‡πÉ‡∏™‡πà comma)
      let cleanStr = String(val).replace(/,/g, '').trim();
      let num = Number(cleanStr);
      
      // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏µ 2001 (1000000000000 ms) ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Timestamp
      if (!isNaN(num) && num > 1000000000000) {
        return num;
      }

      // 2. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô String ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô 2026-02-24, 02/24/2026)
      let d = new Date(val);
      if (!isNaN(d.getTime())) return d.getTime();

      // 3. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© DD/MM/YYYY (‡πÄ‡∏ä‡πà‡∏ô 24/2/2026)
      if (typeof val === 'string' && val.includes('/')) {
        let parts = val.split(' ')[0].split('/');
        if (parts.length === 3) {
          let day = parseInt(parts[0], 10);
          let month = parseInt(parts[1], 10) - 1;
          let year = parseInt(parts[2], 10);
          if (year < 2500 && year >= 2000) { 
             let d2 = new Date(year, month, day);
             if (!isNaN(d2.getTime())) return d2.getTime();
          }
        }
      }

      return null;
    };


    function App() {
      const [activeTab, setActiveTab] = useState('area_hr');
      const [isLoading, setIsLoading] = useState(true); 
      
      // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° State ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå/‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ã‡∏ü‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏•‡∏∏‡∏î
      const [cloudStatus, setCloudStatus] = useState('loading'); // 'loading' | 'connected' | 'syncing' | 'error'
      
      // --- STATE: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô ---
      const [appBranches, setAppBranches] = useState([]);
      const [appAreas, setAppAreas] = useState([]);
      const [appTAs, setAppTAs] = useState([]);
      const [appPositions, setAppPositions] = useState([]);
      
      // --- STATE: UI Modals ---
      const [showSettings, setShowSettings] = useState(false);

      // --- STATE: HR Recruit ---
      const [selectedTA, setSelectedTA] = useState('');
      const [recruitAreaFilter, setRecruitAreaFilter] = useState('');
      const [recruitBranchFilter, setRecruitBranchFilter] = useState('');
      const [addingApplicantFor, setAddingApplicantFor] = useState(null);
      const [formData, setFormData] = useState({ name: '', phone: '', status: '', comment: '', startDate: '', resumeName: '', resumeBase64: '' });
      const [applicants, setApplicants] = useState([]);
      
      // --- STATE: Inline Row Editing (Recruit) ---
      const [editAppId, setEditAppId] = useState(null);
      const [editAppForm, setEditAppForm] = useState({});

      // --- STATE: Preview File ---
      const [previewFile, setPreviewFile] = useState(null);

      // --- STATE: Area HR ---
      const [selectedAreas, setSelectedAreas] = useState([]);
      const [vacancyForm, setVacancyForm] = useState({ branchCode: '', position: '', manualStatus: 'Vacant' });
      const [viewApplicants, setViewApplicants] = useState(null);
      const [vacancies, setVacancies] = useState([]);
      
      // --- STATE: Inline Row Editing (Vacancy) ---
      const [editVacId, setEditVacId] = useState(null);
      const [editVacForm, setEditVacForm] = useState({});

      const [dashboardTA, setDashboardTA] = useState('ALL');

      const uniquePositionNames = useMemo(() => {
        return [...new Set(appPositions.map(p => p.position))];
      }, [appPositions]);

      // --- EFFECTS: Load Data from Google Sheets ---
      useEffect(() => {
        const normalizePositions = (positions) => {
          return positions.map(p => {
            if (typeof p === 'string') return { position: p, recruit: '', area: '' };
            return { 
              position: String(p.position || p.name || '').trim(), 
              recruit: String(p.recruit || '').trim(),
              area: String(p.area || '').trim() 
            };
          });
        };

        const initLoad = async () => {
          setIsLoading(true);
          setCloudStatus('loading');
          
          let isCloudSuccess = false;
          let loadedApps = [];
          let loadedVacs = [];

          try {
            if (GOOGLE_SCRIPT_URL) {
              const res = await fetch(`${GOOGLE_SCRIPT_URL}?t=${new Date().getTime()}`);
              const data = await res.json();
              isCloudSuccess = true;
              setCloudStatus('connected');
              
              if (data.applicants) {
                loadedApps = data.applicants.map(a => ({...a, id: String(a.id), branchCode: String(a.branchCode).padStart(3, '0')}));
              }
              if (data.vacancies) {
                loadedVacs = data.vacancies.map(v => ({...v, id: String(v.id), branchCode: String(v.branchCode).padStart(3, '0')}));
              }

              if (data.branches && data.branches.length > 0) setAppBranches(data.branches.map(b => ({...b, code: String(b.code).padStart(3, '0')})));
              else setAppBranches(DEFAULT_BRANCHES);
              
              if (data.tas && data.tas.length > 0) setAppTAs(data.tas.map(t => String(t.name || t)));
              else setAppTAs(DEFAULT_TAS);
              
              if (data.positions && data.positions.length > 0) setAppPositions(normalizePositions(data.positions));
              else setAppPositions(DEFAULT_POSITIONS);
            }
          } catch (e) {
            console.error("‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Cloud ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à, ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á", e);
            setCloudStatus('error');
            
            let localApps = localStorage.getItem('hr_applicants');
            let localVacs = localStorage.getItem('hr_vacancies');
            
            if (localApps) loadedApps = JSON.parse(localApps);
            if (localVacs) loadedVacs = JSON.parse(localVacs);
            
            const localBranches = localStorage.getItem('hr_branches');
            if (localBranches) { try { setAppBranches(JSON.parse(localBranches)); } catch(err) {} }
            else setAppBranches(DEFAULT_BRANCHES);
            
            const localTAs = localStorage.getItem('hr_tas');
            if (localTAs) { try { setAppTAs(JSON.parse(localTAs)); } catch(e) {} }
            else setAppTAs(DEFAULT_TAS);

            const localPositions = localStorage.getItem('hr_positions');
            if (localPositions) { 
              try { setAppPositions(normalizePositions(JSON.parse(localPositions))); } catch(e) {} 
            }
            else setAppPositions(DEFAULT_POSITIONS);
          }

          // ==========================================
          // ‚öôÔ∏è AUTO-UPDATE LOGIC (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
          // ==========================================
          let needsAutoSync = false;
          const today = new Date();
          today.setHours(0,0,0,0);
          
          loadedApps = loadedApps.map(a => {
            if (a.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && a.startDate) {
              const sDate = new Date(a.startDate);
              sDate.setHours(0,0,0,0);
              if (sDate <= today) {
                needsAutoSync = true;
                return { ...a, status: '‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' };
              }
            }
            return a;
          });

          setApplicants(loadedApps);
          setVacancies(loadedVacs);
          setIsLoading(false);

          // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏∂‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö **‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤)**
          if (needsAutoSync && isCloudSuccess) {
            syncToCloud(loadedApps, loadedVacs, true);
          }
        };
        
        initLoad();
      }, []);

      useEffect(() => {
        if (appBranches.length > 0) {
          const uniqueAreas = [...new Set(appBranches.map(b => String(b.area)))].sort((a,b) => {
            const numA = parseInt(a.replace(/\D/g, '')) || 0;
            const numB = parseInt(b.replace(/\D/g, '')) || 0;
            return numA - numB;
          });
          setAppAreas(uniqueAreas);
        }
      }, [appBranches]);

      // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Sync ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Ç‡∏∂‡πâ‡∏ô Cloud ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ---
      const syncToCloud = async (newApps, newVacs, forceSync = false) => {
        localStorage.setItem('hr_applicants', JSON.stringify(newApps));
        localStorage.setItem('hr_vacancies', JSON.stringify(newVacs));
        
        // üîí ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ã‡∏ü‡∏ï‡∏µ‡πâ: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏°‡∏≤‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î "‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ã‡∏ü‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î" ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏≤‡∏¢
        const isSafeToSync = forceSync || cloudStatus === 'connected' || cloudStatus === 'syncing';

        if (!isSafeToSync) {
            alert('‚ö†Ô∏è [‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô] ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô "‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå"\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö\n\n(‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)');
            return;
        }

        if (GOOGLE_SCRIPT_URL) {
          try {
            setCloudStatus('syncing');
            await fetch(GOOGLE_SCRIPT_URL, {
              method: 'POST',
              mode: 'no-cors',
              headers: { 'Content-Type': 'text/plain;charset=utf-8' },
              body: JSON.stringify({ action: 'saveAll', applicants: newApps, vacancies: newVacs })
            });
            setTimeout(() => setCloudStatus('connected'), 1000);
          } catch (error) {
            console.error('Sync Error:', error);
            setCloudStatus('error');
          }
        }
      };

      // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Sync Master Data (Branches, TAs, Positions) ‡∏Ç‡∏∂‡πâ‡∏ô Cloud ---
      const syncMasterToCloud = async (newBranches, newTAs, newPositions) => {
        if (cloudStatus === 'error') {
            alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå Master ‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
            return;
        }

        setIsLoading(true);
        setCloudStatus('syncing');
        if (GOOGLE_SCRIPT_URL) {
          try {
            await fetch(GOOGLE_SCRIPT_URL, {
              method: 'POST',
              mode: 'no-cors',
              headers: { 'Content-Type': 'text/plain;charset=utf-8' },
              body: JSON.stringify({ 
                action: 'updateMaster', 
                branches: newBranches, 
                tas: newTAs.map(name => ({name})), 
                positions: newPositions 
              })
            });
            setCloudStatus('connected');
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Master Data ‡∏Ç‡∏∂‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
          } catch (error) {
            console.error('Sync Master Error:', error);
            setCloudStatus('error');
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
          }
        }
        setIsLoading(false);
      };

      // --- IMPORT CSV FUNCTIONS ---
      const handleImportCSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (evt) => {
          try {
            const bstr = evt.target.result;
            const wb = XLSX.read(bstr, { type: 'binary' });
            const wsname = wb.SheetNames[0];
            const data = XLSX.utils.sheet_to_json(wb.Sheets[wsname], { header: 1 });
            
            const newBranches = [];
            for (let i = 1; i < data.length; i++) {
              const row = data[i];
              if (row && row[0] && row[1] && row[2]) {
                const code = String(row[0]).padStart(3, '0');
                const name = String(row[1]).replace(/\n/g, ' ').replace(/\r/g, '').trim();
                const area = String(row[2]).replace(/\r/g, '').trim();
                newBranches.push({ code, name, area });
              }
            }

            if (newBranches.length > 0) {
              setAppBranches(newBranches);
              localStorage.setItem('hr_branches', JSON.stringify(newBranches));
              syncMasterToCloud(newBranches, appTAs, appPositions);
            } else {
              alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Store No., Location Name, Area No.)');
            }
          } catch (err) {
            console.error(err);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV ‡∏™‡∏≤‡∏Ç‡∏≤');
          }
        };
        reader.readAsBinaryString(file);
      };

      const handleImportPositionCSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (evt) => {
          try {
            const bstr = evt.target.result;
            const wb = XLSX.read(bstr, { type: 'binary' });
            const wsname = wb.SheetNames[0];
            const data = XLSX.utils.sheet_to_json(wb.Sheets[wsname], { header: 1 });
            
            const newPositions = [];
            const newTAsSet = new Set(appTAs);
            let foundNewTA = false;

            for (let i = 1; i < data.length; i++) {
              const row = data[i];
              if (row && row[0]) {
                const posName = String(row[0]).replace(/\r/g, '').trim();
                const recruitName = row[1] ? String(row[1]).replace(/\r/g, '').trim() : '';
                const areaName = row[2] ? String(row[2]).replace(/\r/g, '').trim() : '';
                
                if (posName) {
                  newPositions.push({ position: posName, recruit: recruitName, area: areaName });
                  if (recruitName && !newTAsSet.has(recruitName)) {
                    newTAsSet.add(recruitName);
                    foundNewTA = true;
                  }
                }
              }
            }

            if (newPositions.length > 0) {
              setAppPositions(newPositions);
              localStorage.setItem('hr_positions', JSON.stringify(newPositions));
              
              const updatedTAs = Array.from(newTAsSet);
              if (foundNewTA) {
                setAppTAs(updatedTAs);
                localStorage.setItem('hr_tas', JSON.stringify(updatedTAs));
              }
              
              syncMasterToCloud(appBranches, updatedTAs, newPositions);
              
              if (foundNewTA) {
                alert(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n- ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Area ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${newPositions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ TA ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà)`);
              } else {
                alert(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${newPositions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
              }
            } else {
              alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î)');
            }
          } catch (err) {
            console.error(err);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô');
          }
        };
        reader.readAsBinaryString(file);
      };

      const handleImportTACSV = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (evt) => {
          try {
            const bstr = evt.target.result;
            const wb = XLSX.read(bstr, { type: 'binary' });
            const wsname = wb.SheetNames[0];
            const data = XLSX.utils.sheet_to_json(wb.Sheets[wsname], { header: 1 });
            
            const newTAs = [];
            for (let i = 1; i < data.length; i++) {
              const row = data[i];
              if (row && row[0]) {
                const taName = String(row[0]).replace(/\r/g, '').trim();
                if (taName) newTAs.push(taName);
              }
            }

            if (newTAs.length > 0) {
              setAppTAs(newTAs);
              localStorage.setItem('hr_tas', JSON.stringify(newTAs));
              syncMasterToCloud(appBranches, newTAs, appPositions);
            } else {
              alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠ TA ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î)');
            }
          } catch (err) {
            console.error(err);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ TA');
          }
        };
        reader.readAsBinaryString(file);
      };

      // --- EXPORT EXCEL ---
      const exportToExcel = (dataList, filename) => {
        const worksheet = XLSX.utils.json_to_sheet(dataList);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Data");
        XLSX.writeFile(workbook, `${filename}.xlsx`);
      };

      // --- HANDLERS: HR Recruit ---
      const handleInputChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));
      
      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            setFormData(prev => ({ ...prev, resumeBase64: reader.result, resumeName: file.name }));
          };
          reader.readAsDataURL(file);
        }
      };
      
      const handleRecruitSubmit = async (e) => {
        e.preventDefault();
        if (!selectedTA || !addingApplicantFor) return;
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
        if (formData.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && !formData.startDate) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô');
          return;
        }
        
        const newRecord = { 
          id: Date.now().toString(), 
          ta: selectedTA, 
          branchCode: String(addingApplicantFor.branchCode).padStart(3, '0'), 
          branchName: addingApplicantFor.branchName, 
          position: addingApplicantFor.position,
          ...formData, 
          timestamp: new Date().toLocaleString('th-TH'),
          updatedAt: Date.now() // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î SLA
        };
        
        const newApps = [newRecord, ...applicants];
        setApplicants(newApps);
        setFormData({ name: '', phone: '', status: '', comment: '', startDate: '', resumeName: '', resumeBase64: '' });
        setAddingApplicantFor(null);
        
        syncToCloud(newApps, vacancies);
      };

      const deleteApplicant = (id) => {
        if (window.confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?')) {
          const newApps = applicants.filter(a => String(a.id) !== String(id));
          setApplicants(newApps);
          syncToCloud(newApps, vacancies);
        }
      };

      // --- INLINE ROW EDITING (Applicants) ---
      const startEditApp = (app) => {
        setEditAppId(app.id);
        setEditAppForm({ ...app });
      };

      const saveEditApp = () => {
        // Validation ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
        if (['‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', '‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô'].includes(editAppForm.status) && !editAppForm.comment) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î');
          return;
        }
        // Validation ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
        if (editAppForm.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && !editAppForm.startDate) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô');
          return;
        }
        
        if (!['‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', '‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô'].includes(editAppForm.status)) {
          editAppForm.comment = '';
        }

        const newApps = applicants.map(a => String(a.id) === String(editAppId) ? { ...editAppForm, updatedAt: Date.now() } : a);
        setApplicants(newApps);
        setEditAppId(null);
        syncToCloud(newApps, vacancies);
      };

      const handleInlineStatusChange = (app, newStatus) => {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Inline
        if (['‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', '‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô', '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô'].includes(newStatus)) {
          startEditApp({ ...app, status: newStatus });
        } else {
          const updatedApp = { ...app, status: newStatus, comment: '', startDate: '', updatedAt: Date.now() };
          const newApps = applicants.map(a => String(a.id) === String(app.id) ? updatedApp : a);
          setApplicants(newApps);
          syncToCloud(newApps, vacancies);
        }
      };

      // --- HANDLERS: Area HR ---
      const toggleArea = (area) => {
        setSelectedAreas(prev => prev.includes(area) ? prev.filter(a => a !== area) : [...prev, area]);
        setVacancyForm(prev => ({...prev, branchCode: ''}));
      };
      const handleVacancyInputChange = (e) => setVacancyForm(prev => ({ ...prev, [e.target.name]: e.target.value }));

      const handleVacancySubmit = (e) => {
        e.preventDefault();
        const branch = appBranches.find(b => String(b.code) === String(vacancyForm.branchCode));
        if (!branch) { 
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà'); 
          return; 
        }

        const isDuplicate = vacancies.some(v => 
          String(v.branchCode) === String(branch.code) && 
          String(v.position) === String(vacancyForm.position) && 
          v.manualStatus !== 'Closed'
        );
        if (isDuplicate) { alert(`‡∏°‡∏µ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á "${vacancyForm.position}" ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!`); return; }

        const newVacancy = { 
          id: Date.now().toString(), 
          area: branch.area, 
          branchCode: String(branch.code).padStart(3, '0'), 
          branchName: branch.name, 
          position: vacancyForm.position, 
          manualStatus: vacancyForm.manualStatus, 
          createdAt: Date.now(), 
          timestamp: new Date().toLocaleString('th-TH') 
        };
        
        const newVacs = [newVacancy, ...vacancies];
        setVacancies(newVacs);
        setVacancyForm({ branchCode: '', position: '', manualStatus: 'Vacant' });
        
        // ‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡∏µ‡∏ï ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        syncToCloud(applicants, newVacs);
        
        // ‡∏™‡πà‡∏á Email (‡πÅ‡∏Ñ‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏™‡πà‡∏á ‡∏ñ‡πâ‡∏≤ Cloud ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÑ‡∏°‡πà error)
        if (GOOGLE_SCRIPT_URL && cloudStatus === 'connected') {
          try {
            fetch(GOOGLE_SCRIPT_URL, {
              method: 'POST',
              mode: 'no-cors',
              headers: { 'Content-Type': 'text/plain;charset=utf-8' },
              body: JSON.stringify({ action: 'notifyNewVacancy', vacancy: newVacancy })
            });
          } catch (error) { console.error('Email Error:', error); }
        }
      };

      const deleteVacancy = (id) => {
        if (window.confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?')) {
          const newVacs = vacancies.filter(v => String(v.id) !== String(id));
          setVacancies(newVacs);
          syncToCloud(applicants, newVacs);
        }
      };

      // --- INLINE ROW EDITING (Vacancies) ---
      const startEditVac = (v) => {
        setEditVacId(v.id);
        setEditVacForm({ ...v });
      };

      const saveEditVac = () => {
        const isDuplicate = vacancies.some(v => 
          String(v.id) !== String(editVacId) && 
          String(v.branchCode) === String(editVacForm.branchCode) && 
          String(v.position) === String(editVacForm.position) && 
          v.manualStatus !== 'Closed'
        );
        if (isDuplicate) { alert(`‡∏°‡∏µ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á "${editVacForm.position}" ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß!`); return; }
        
        const branch = appBranches.find(b => String(b.code) === String(editVacForm.branchCode));
        const newVacs = vacancies.map(v => String(v.id) === String(editVacId) ? { ...editVacForm, area: branch ? branch.area : v.area, branchName: branch ? branch.name : v.branchName } : v);
        setVacancies(newVacs);
        setEditVacId(null);
        syncToCloud(applicants, newVacs);
      };

      const closeVacancy = (id) => {
        const newVacs = vacancies.map(v => String(v.id) === String(id) ? { ...v, manualStatus: 'Closed' } : v);
        setVacancies(newVacs);
        syncToCloud(applicants, newVacs);
      };

      // --- DERIVED DATA & SLA LOGIC ---
      const availableBranchesForAreas = appBranches.filter(b => selectedAreas.includes(b.area));
      const filteredVacancies = vacancies.filter(v => selectedAreas.length === 0 || selectedAreas.includes(v.area));

      const getVacancyInsights = (v) => {
        const matchedApplicants = applicants.filter(app => String(app.branchCode) === String(v.branchCode) && String(app.position) === String(v.position));
        const applicantCount = matchedApplicants.length;
        let computedStatus = v.manualStatus;
        if (v.manualStatus !== 'Closed') {
          if (matchedApplicants.some(app => app.status === '‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô')) computedStatus = 'Hiring';
          else if (matchedApplicants.some(app => app.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô')) computedStatus = '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô';
          else if (matchedApplicants.some(app => app.status === '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û')) computedStatus = '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û';
        }
        
        // SLA Logic: ‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô"
        let slaEndTime = Date.now();
        const hiredApps = matchedApplicants.filter(app => ['‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô', '‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô'].includes(app.status));
        if (hiredApps.length > 0) {
          // ‡∏´‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡πÇ‡∏î‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞
          slaEndTime = Math.min(...hiredApps.map(a => parseDateToMs(a.updatedAt) || parseDateToMs(a.id) || Date.now()));
        }

        // ‡∏´‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞
        let startMs = parseDateToMs(v.createdAt) || parseDateToMs(v.id) || Date.now();

        const slaDays = Math.max(0, Math.floor((slaEndTime - startMs) / (1000 * 60 * 60 * 24)));
        return { applicantCount, computedStatus, slaDays, matchedApplicants };
      };

      // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö Recruit: ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö
      const activeVacanciesForRecruit = useMemo(() => {
        return vacancies.filter(v => {
          if (v.manualStatus === 'Closed') return false;
          if (recruitAreaFilter && String(v.area) !== String(recruitAreaFilter)) return false;
          if (recruitBranchFilter && String(v.branchCode) !== String(recruitBranchFilter)) return false;

          if (selectedTA) {
            const currentTA = String(selectedTA).trim().toLowerCase();
            const vacPos = String(v.position).trim();
            const vacArea = String(v.area).trim().toLowerCase();

            const posRules = appPositions.filter(p => String(p.position).trim() === vacPos);

            if (posRules.length > 0) {
              let matchingRule = posRules.find(p => {
                if (!p.area || String(p.area).trim() === '') return false;
                const ruleAreas = String(p.area).split(',').map(a => a.trim().toLowerCase());
                return ruleAreas.includes(vacArea);
              });

              if (!matchingRule) {
                matchingRule = posRules.find(p => !p.area || String(p.area).trim() === '');
              }

              if (matchingRule) {
                const assignedRecruit = String(matchingRule.recruit).trim().toLowerCase();
                if (assignedRecruit !== '' && assignedRecruit !== currentTA) {
                  return false;
                }
              }
            }
          }

          return true;
        });
      }, [vacancies, recruitAreaFilter, recruitBranchFilter, appPositions, selectedTA]);

      const branchesForRecruitFilter = appBranches.filter(b => !recruitAreaFilter || String(b.area) === String(recruitAreaFilter));
      
      const myApplicants = applicants.filter(app => String(app.ta) === String(selectedTA));

      const dashboardData = useMemo(() => dashboardTA === 'ALL' ? applicants : applicants.filter(app => String(app.ta) === String(dashboardTA)), [applicants, dashboardTA]);
      
      const statusChartData = useMemo(() => {
        const counts = {}; dashboardData.forEach(app => counts[app.status] = (counts[app.status] || 0) + 1);
        return Object.keys(counts).map(key => ({ name: key, value: counts[key] })).sort((a, b) => b.value - a.value);
      }, [dashboardData]);
      
      const branchChartData = useMemo(() => {
        const counts = {}; dashboardData.forEach(app => counts[app.branchName] = (counts[app.branchName] || 0) + 1);
        return Object.keys(counts).map(key => ({ name: key, count: counts[key] })).sort((a, b) => b.count - a.count);
      }, [dashboardData]);

      const slaChartData = useMemo(() => {
        const buckets = [
          { name: '0-14 ‡∏ß‡∏±‡∏ô', count: 0, fill: '#10B981' }, 
          { name: '15-30 ‡∏ß‡∏±‡∏ô', count: 0, fill: '#F59E0B' }, 
          { name: '31-45 ‡∏ß‡∏±‡∏ô', count: 0, fill: '#F97316' }, 
          { name: '‡πÄ‡∏Å‡∏¥‡∏ô 45 ‡∏ß‡∏±‡∏ô', count: 0, fill: '#EF4444' } 
        ];
        vacancies.forEach(v => {
          if (v.manualStatus !== 'Closed') {
            const { slaDays } = getVacancyInsights(v);
            if (slaDays <= 14) buckets[0].count++;
            else if (slaDays <= 30) buckets[1].count++;
            else if (slaDays <= 45) buckets[2].count++;
            else buckets[3].count++;
          }
        });
        return buckets;
      }, [vacancies, applicants]); // ‡πÇ‡∏¢‡∏á applicants ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠ SLA ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏•‡∏á


      // --- COMPONENTS ---
      return (
        <div className="min-h-screen font-sans text-slate-800 pb-10 relative">
          
          {/* Loading Overlay */}
          {isLoading && (
            <div className="fixed inset-0 z-[100] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center transition-all">
              <div className="bg-white px-8 py-6 rounded-2xl shadow-xl flex flex-col items-center space-y-4 animate-in fade-in zoom-in duration-300">
                <div className="animate-spin w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full"></div>
                <span className="font-bold text-slate-700 text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö...</span>
                <span className="text-xs text-slate-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</span>
              </div>
            </div>
          )}

          {/* Navbar */}
          <nav className="bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex flex-col md:flex-row justify-between h-auto md:h-16 py-3 md:py-0">
                <div className="flex items-center space-x-3 mb-3 md:mb-0">
                  <div className="w-9 h-9 rounded-lg bg-blue-600 flex items-center justify-center text-white shadow-sm">
                    <Users size={20} strokeWidth={2.5} />
                  </div>
                  <span className="text-xl font-bold text-slate-900 tracking-tight">HR <span className="text-blue-600 font-black">Recruit</span></span>
                </div>
                
                {/* Tabs & Import Buttons */}
                <div className="flex items-center justify-between overflow-x-auto pb-1 md:pb-0 hide-scrollbar w-full md:w-auto space-x-4">
                  <div className="flex space-x-1 bg-slate-100/80 p-1 rounded-xl border border-slate-200/60 whitespace-nowrap">
                    <button onClick={() => setActiveTab('area_hr')} className={`flex items-center space-x-2 px-4 py-1.5 rounded-lg text-sm font-medium transition-all ${activeTab === 'area_hr' ? 'bg-white text-blue-700 shadow-sm ring-1 ring-slate-900/5' : 'text-slate-500 hover:text-slate-700 hover:bg-slate-200/50'}`}>
                      <Briefcase size={16} strokeWidth={activeTab === 'area_hr' ? 2.5 : 2} /><span>Area HR (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô)</span>
                    </button>
                    <button onClick={() => setActiveTab('entry')} className={`flex items-center space-x-2 px-4 py-1.5 rounded-lg text-sm font-medium transition-all ${activeTab === 'entry' ? 'bg-white text-blue-700 shadow-sm ring-1 ring-slate-900/5' : 'text-slate-500 hover:text-slate-700 hover:bg-slate-200/50'}`}>
                      <UserPlus size={16} strokeWidth={activeTab === 'entry' ? 2.5 : 2} /><span>Recruit (‡∏Ñ‡∏µ‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£)</span>
                    </button>
                    <button onClick={() => setActiveTab('dashboard')} className={`flex items-center space-x-2 px-4 py-1.5 rounded-lg text-sm font-medium transition-all ${activeTab === 'dashboard' ? 'bg-white text-blue-700 shadow-sm ring-1 ring-slate-900/5' : 'text-slate-500 hover:text-slate-700 hover:bg-slate-200/50'}`}>
                      <BarChart3 size={16} strokeWidth={activeTab === 'dashboard' ? 2.5 : 2} /><span>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</span>
                    </button>
                  </div>

                  <div className="flex items-center space-x-2">
                    {/* Status Indicator */}
                    <div className="hidden md:flex items-center space-x-1.5 px-3 py-1.5 rounded-lg text-xs font-bold bg-slate-50 border border-slate-200" title={cloudStatus === 'error' ? "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Cloud ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∂‡∏á‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏ã‡∏ü‡∏ó‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß" : "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á"}>
                        {cloudStatus === 'loading' && <><div className="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div><span className="text-slate-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span></>}
                        {cloudStatus === 'connected' && <><div className="w-2 h-2 bg-emerald-500 rounded-full shadow-[0_0_8px_rgba(16,185,129,0.8)]"></div><span className="text-emerald-700">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span></>}
                        {cloudStatus === 'syncing' && <><div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div><span className="text-blue-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå...</span></>}
                        {cloudStatus === 'error' && <><div className="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div><span className="text-red-700">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå (‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</span></>}
                    </div>

                    <button onClick={() => setShowSettings(true)} className="flex items-center space-x-1.5 bg-slate-100 text-slate-600 hover:bg-slate-200 px-3 py-2 rounded-lg transition-colors text-sm font-semibold border border-slate-200 shadow-sm whitespace-nowrap">
                      <Settings size={16} />
                      <span className="hidden sm:inline">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </nav>

          <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            {/* --- TAB: AREA HR --- */}
            {activeTab === 'area_hr' && (
              <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500 relative">
                
                {/* Area Select */}
                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8">
                  <div className="mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div>
                      <h2 className="text-lg font-bold text-slate-900 flex items-center space-x-2">
                        <Map className="text-blue-600" size={22} /><span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (Area Selection)</span>
                      </h2>
                      <p className="text-sm text-slate-500 mt-1 ml-7">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Area ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1)</p>
                    </div>
                    <div className="text-sm font-semibold text-blue-600 bg-blue-50 px-4 py-2 rounded-xl border border-blue-100 shadow-sm">
                      ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà <span className="text-lg mx-1">{selectedAreas.length}</span> Area
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3">
                    {appAreas.map(area => {
                      const isSelected = selectedAreas.includes(area);
                      return (
                        <button 
                          key={area} 
                          onClick={() => toggleArea(area)} 
                          className={`flex items-center justify-center px-2 py-3 rounded-xl text-sm font-bold border transition-all duration-200 transform hover:scale-[1.02] active:scale-95 ${
                            isSelected 
                              ? 'bg-gradient-to-br from-blue-600 to-blue-700 text-white border-blue-600 shadow-md shadow-blue-500/30' 
                              : 'bg-white text-slate-600 border-slate-200 hover:border-blue-300 hover:bg-blue-50/50 hover:text-blue-700 shadow-sm'
                          }`}
                        >
                          {area}
                        </button>
                      )
                    })}
                  </div>
                </div>

                {/* Form Add Vacancy */}
                {selectedAreas.length > 0 && (
                  <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="bg-slate-50/50 border-b border-slate-100 px-6 py-5 flex items-center space-x-3">
                      <div className="bg-blue-100 text-blue-600 p-2 rounded-lg"><Target size={20} strokeWidth={2} /></div>
                      <h2 className="text-lg font-bold text-slate-900">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</h2>
                    </div>
                    <form onSubmit={handleVacancySubmit} className="p-6 space-y-6">
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                          <label className="block text-sm font-semibold text-slate-700 mb-2">1. ‡∏£‡∏´‡∏±‡∏™-‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤ <span className="text-red-500">*</span></label>
                          <select required name="branchCode" value={vacancyForm.branchCode} onChange={handleVacancyInputChange} className="w-full bg-white border border-slate-300 rounded-xl px-4 py-2.5 focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô Area ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î --</option>
                            {availableBranchesForAreas.map(b => <option key={b.code} value={b.code}>[{b.area}] {b.code} - {b.name}</option>)}
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-slate-700 mb-2">2. ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô <span className="text-red-500">*</span></label>
                          <select required name="position" value={vacancyForm.position} onChange={handleVacancyInputChange} className="w-full bg-white border border-slate-300 rounded-xl px-4 py-2.5 focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô --</option>
                            {uniquePositionNames.map(pos => <option key={pos} value={pos}>{pos}</option>)}
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-slate-700 mb-2">3. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô <span className="text-red-500">*</span></label>
                          <select required name="manualStatus" value={vacancyForm.manualStatus} onChange={handleVacancyInputChange} className="w-full bg-white border border-slate-300 rounded-xl px-4 py-2.5 focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none">
                            {VACANCY_STATUSES.filter(s => s !== 'Closed').map(s => <option key={s} value={s}>{s}</option>)}
                          </select>
                        </div>
                      </div>
                      <div className="flex justify-end pt-2">
                        <button type="submit" className="bg-slate-800 hover:bg-slate-900 text-white font-semibold py-2.5 px-6 rounded-xl shadow-sm flex items-center space-x-2 transition-colors">
                          <Briefcase size={16} /><span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</span>
                        </button>
                      </div>
                    </form>
                  </div>
                )}

                {/* Table Vacancies */}
                {selectedAreas.length > 0 && (
                  <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-white flex-wrap gap-4">
                      <div>
                        <h3 className="font-bold text-slate-900 text-lg">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô (Job Vacancies)</h3>
                        <p className="text-sm text-slate-500 mt-0.5">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà <span className="font-semibold text-blue-600">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏î‡∏¥‡∏ô‡∏™‡∏≠</span> ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î</p>
                      </div>
                      <div className="flex items-center space-x-3">
                        <span className="bg-slate-100 text-slate-600 text-xs font-bold px-3 py-2 rounded-lg border border-slate-200">
                          ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span className="text-blue-600 text-sm mx-1">{filteredVacancies.length}</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </span>
                        <button onClick={() => exportToExcel(filteredVacancies, 'Vacancies_Export')} className="flex items-center space-x-1.5 bg-emerald-50 text-emerald-700 hover:bg-emerald-600 hover:text-white border border-emerald-200 text-xs font-bold px-3 py-2 rounded-lg transition-colors shadow-sm">
                          <Download size={14} /><span>Export Excel</span>
                        </button>
                      </div>
                    </div>
                    
                    <div className="overflow-x-auto">
                      <table className="w-full text-sm text-left whitespace-nowrap">
                        <thead className="bg-slate-50/80 border-b border-slate-100">
                          <tr>
                            <th className="px-5 py-3.5 font-semibold text-slate-600 uppercase text-xs">Area / ‡∏™‡∏≤‡∏Ç‡∏≤</th>
                            <th className="px-5 py-3.5 font-semibold text-slate-600 uppercase text-xs">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</th>
                            <th className="px-5 py-3.5 font-semibold text-slate-600 uppercase text-xs text-center">SLA</th>
                            <th className="px-5 py-3.5 font-semibold text-slate-600 uppercase text-xs text-center">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
                            <th className="px-5 py-3.5 font-semibold text-slate-600 uppercase text-xs">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô</th>
                            <th className="px-5 py-3.5 font-semibold text-slate-600 uppercase text-xs text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                          </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-100">
                          {filteredVacancies.length === 0 ? (
                            <tr><td colSpan="6" className="px-6 py-12 text-center text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Area ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</td></tr>
                          ) : (
                            filteredVacancies.map((v) => {
                              
                              // ‡∏ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (Inline Edit)
                              if (editVacId === v.id) {
                                return (
                                  <tr key={v.id} className="bg-blue-50/50 shadow-inner">
                                    <td className="px-3 py-3">
                                      <select value={editVacForm.branchCode} onChange={(e) => setEditVacForm({...editVacForm, branchCode: e.target.value})} className="w-full text-xs font-semibold border-slate-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 shadow-sm">
                                        {availableBranchesForAreas.map(b => <option key={b.code} value={b.code}>[{b.area}] {b.name}</option>)}
                                      </select>
                                    </td>
                                    <td className="px-3 py-3">
                                      <select value={editVacForm.position} onChange={(e) => setEditVacForm({...editVacForm, position: e.target.value})} className="w-full text-xs font-semibold border-slate-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 shadow-sm">
                                        {uniquePositionNames.map(pos => <option key={pos} value={pos}>{pos}</option>)}
                                      </select>
                                    </td>
                                    <td className="px-3 py-3 text-center text-slate-400 text-xs">- ‡∏≠‡∏≠‡πÇ‡∏ï‡πâ -</td>
                                    <td className="px-3 py-3 text-center text-slate-400 text-xs">- ‡∏≠‡∏≠‡πÇ‡∏ï‡πâ -</td>
                                    <td className="px-3 py-3">
                                      <select value={editVacForm.manualStatus} onChange={(e) => setEditVacForm({...editVacForm, manualStatus: e.target.value})} className="w-full text-xs font-semibold border-slate-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 shadow-sm">
                                        {VACANCY_STATUSES.map(s => <option key={s} value={s}>{s}</option>)}
                                      </select>
                                    </td>
                                    <td className="px-3 py-3 text-right whitespace-nowrap">
                                      <button onClick={saveEditVac} className="inline-flex items-center justify-center bg-emerald-100 text-emerald-700 hover:bg-emerald-600 hover:text-white px-3 py-1.5 rounded-lg text-xs font-bold transition-colors mr-2 shadow-sm"><Check size={14} className="mr-1"/>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                      <button onClick={() => setEditVacId(null)} className="inline-flex items-center justify-center bg-slate-200 text-slate-600 hover:bg-slate-300 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors shadow-sm"><X size={14} className="mr-1"/>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                    </td>
                                  </tr>
                                )
                              }

                              // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
                              const { applicantCount, computedStatus, slaDays, matchedApplicants } = getVacancyInsights(v);
                              const isHiringAlert = computedStatus === 'Hiring' || computedStatus === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô';

                              return (
                                <tr key={v.id} className={`transition-colors ${isHiringAlert ? 'bg-emerald-50/40 hover:bg-emerald-50' : 'hover:bg-slate-50/50'}`}>
                                  <td className="px-5 py-4">
                                    <div className="text-xs font-bold text-blue-600 mb-0.5">{v.area}</div>
                                    <div className="font-semibold text-slate-900">{v.branchName}</div>
                                    <div className="text-xs text-slate-400">{v.branchCode}</div>
                                  </td>
                                  
                                  {/* Click to Edit Vacancy */}
                                  <td className="px-5 py-4 cursor-pointer group" onClick={() => startEditVac(v)} title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                    <div className="text-slate-800 font-bold flex items-center gap-1.5 group-hover:text-blue-600 transition-colors">
                                      {v.position} <Edit size={12} className="opacity-0 group-hover:opacity-100 transition-opacity text-blue-500" />
                                    </div>
                                  </td>
                                  
                                  <td className="px-5 py-4 text-center">
                                    <div className={`inline-flex flex-col items-center justify-center min-w-[40px] ${slaDays > 30 ? 'text-red-500' : 'text-slate-600'}`}>
                                      <span className="font-black text-base">{slaDays}</span>
                                      <span className="text-[10px] font-semibold uppercase">‡∏ß‡∏±‡∏ô</span>
                                    </div>
                                  </td>

                                  <td className="px-5 py-4 text-center">
                                    <button 
                                      onClick={() => setViewApplicants({ position: v.position, branchName: v.branchName, list: matchedApplicants })}
                                      disabled={applicantCount === 0}
                                      className={`inline-flex items-center justify-center min-w-[36px] h-9 rounded-xl font-bold text-sm border transition-all ${
                                        applicantCount > 0 
                                          ? 'bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-600 hover:text-white hover:shadow-md cursor-pointer' 
                                          : 'bg-slate-50 text-slate-400 border-slate-200 cursor-not-allowed'
                                      }`}
                                    >
                                      {applicantCount}
                                    </button>
                                  </td>

                                  <td className="px-5 py-4">
                                    <div className="flex flex-col items-start gap-1">
                                      <div className="flex items-center space-x-2">
                                        <div className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold"
                                          style={{ backgroundColor: `${VACANCY_COLORS[computedStatus] || '#475569'}15`, color: VACANCY_COLORS[computedStatus] || '#475569', border: `1px solid ${VACANCY_COLORS[computedStatus] || '#475569'}30` }}
                                        >
                                          <span className="w-1.5 h-1.5 rounded-full mr-1.5" style={{ backgroundColor: VACANCY_COLORS[computedStatus] || '#475569' }}></span>
                                          {computedStatus}
                                        </div>
                                        {isHiringAlert && <BellRing className="w-4 h-4 text-red-500 animate-bounce" />}
                                      </div>
                                    </div>
                                  </td>

                                  <td className="px-5 py-4">
                                    <div className="flex items-center justify-end space-x-2">
                                      {isHiringAlert && (
                                        <button onClick={() => closeVacancy(v.id)} className="flex items-center space-x-1 text-xs bg-red-50 text-red-600 px-2.5 py-1.5 rounded-lg border border-red-200 hover:bg-red-500 hover:text-white transition-colors shadow-sm font-semibold">
                                          <CheckCircle2 size={14} /><span>‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</span>
                                        </button>
                                      )}
                                      <button onClick={() => startEditVac(v)} className="p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
                                        <Edit size={16} />
                                      </button>
                                      <button onClick={() => deleteVacancy(v.id)} className="p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="‡∏•‡∏ö">
                                        <Trash2 size={16} />
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                              );
                            })
                          )}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* --- TAB: RECRUIT ENTRY --- */}
            {activeTab === 'entry' && (
              <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500">
                
                {/* 1. TA Selection */}
                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8">
                  <div className="mb-6">
                    <h2 className="text-lg font-bold text-slate-900 flex items-center space-x-2"><UserPlus className="text-blue-600" size={22} /><span>‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (Recruiter)</span></h2>
                    <p className="text-sm text-slate-500 mt-1 ml-7">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠ TA ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö</p>
                  </div>
                  <div className="max-w-md ml-0 md:ml-7">
                    <label className="block text-sm font-semibold text-slate-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (TA) <span className="text-red-500">*</span></label>
                    <select value={selectedTA} onChange={(e) => setSelectedTA(e.target.value)} className="w-full bg-white border border-slate-300 rounded-xl px-4 py-3 focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none shadow-sm">
                      <option value="">-- ‡∏£‡∏∞‡∏ö‡∏∏ TA --</option>
                      {appTAs.map(ta => <option key={ta} value={ta}>{ta}</option>)}
                    </select>
                  </div>
                </div>

                {selectedTA && (
                  <>
                    {/* 2. Vacancies List for Recruiter */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                      <div className="p-6 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-4 bg-slate-50/50">
                        <div>
                          <h3 className="font-bold text-slate-900 text-lg flex items-center space-x-2">
                            <Target className="text-blue-600" size={20} />
                            <span>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö (Active Vacancies)</span>
                          </h3>
                          <p className="text-sm text-slate-500 mt-1 ml-7">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏î‡∏π‡πÅ‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</p>
                        </div>
                        
                        {/* Filters for Recruit Table */}
                        <div className="flex items-center space-x-3 w-full md:w-auto">
                          <select value={recruitAreaFilter} onChange={(e) => { setRecruitAreaFilter(e.target.value); setRecruitBranchFilter(''); }} className="w-full md:w-32 bg-white border border-slate-300 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
                            <option value="">‡∏ó‡∏∏‡∏Å Area</option>
                            {appAreas.map(area => <option key={area} value={area}>{area}</option>)}
                          </select>
                          <select value={recruitBranchFilter} onChange={(e) => setRecruitBranchFilter(e.target.value)} className="w-full md:w-48 bg-white border border-slate-300 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-blue-500" disabled={!recruitAreaFilter}>
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                            {branchesForRecruitFilter.map(b => <option key={b.code} value={b.code}>{b.name}</option>)}
                          </select>
                        </div>
                      </div>

                      <div className="overflow-x-auto">
                        <table className="w-full text-sm text-left whitespace-nowrap">
                          <thead className="bg-white border-b border-slate-100">
                            <tr>
                              <th className="px-6 py-3.5 font-semibold text-slate-600 uppercase text-xs">Area / ‡∏™‡∏≤‡∏Ç‡∏≤</th>
                              <th className="px-6 py-3.5 font-semibold text-slate-600 uppercase text-xs">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö</th>
                              <th className="px-6 py-3.5 font-semibold text-slate-600 uppercase text-xs text-center">‡∏¢‡∏≠‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß</th>
                              <th className="px-6 py-3.5 font-semibold text-slate-600 uppercase text-xs text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                              <th className="px-6 py-3.5 font-semibold text-slate-600 uppercase text-xs text-right">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                          </thead>
                          <tbody className="divide-y divide-slate-50">
                            {activeVacanciesForRecruit.length === 0 ? (
                              <tr><td colSpan="5" className="px-6 py-12 text-center text-slate-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏≤‡∏Å Area HR</td></tr>
                            ) : (
                              activeVacanciesForRecruit.map(v => {
                                const { applicantCount, computedStatus } = getVacancyInsights(v);
                                return (
                                  <tr key={v.id} className="hover:bg-blue-50/30 transition-colors group">
                                    <td className="px-6 py-4">
                                      <div className="text-xs font-bold text-blue-600 mb-0.5">{v.area}</div>
                                      <div className="font-semibold text-slate-900">{v.branchName}</div>
                                    </td>
                                    <td className="px-6 py-4 font-bold text-slate-800">{v.position}</td>
                                    <td className="px-6 py-4 text-center">
                                      <span className={`inline-flex items-center justify-center min-w-[32px] h-8 rounded-lg font-bold text-sm border ${applicantCount > 0 ? 'bg-blue-50 text-blue-700 border-blue-200' : 'bg-slate-50 text-slate-400 border-slate-200'}`}>
                                        {applicantCount}
                                      </span>
                                    </td>
                                    <td className="px-6 py-4 text-center">
                                      <div className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold" style={{ backgroundColor: `${VACANCY_COLORS[computedStatus] || '#475569'}15`, color: VACANCY_COLORS[computedStatus] || '#475569', border: `1px solid ${VACANCY_COLORS[computedStatus] || '#475569'}30` }}>
                                        {computedStatus}
                                      </div>
                                    </td>
                                    <td className="px-6 py-4 text-right">
                                      <button 
                                        onClick={() => setAddingApplicantFor(v)}
                                        className="inline-flex items-center space-x-1.5 bg-blue-600 text-white hover:bg-blue-700 px-4 py-2 rounded-xl text-sm font-semibold transition-colors shadow-sm"
                                      >
                                        <PlusCircle size={16} />
                                        <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</span>
                                      </button>
                                    </td>
                                  </tr>
                                );
                              })
                            )}
                          </tbody>
                        </table>
                      </div>
                    </div>

                    {/* 3. My Applicant History */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 mt-8">
                      <div className="px-6 py-5 border-b flex justify-between items-center flex-wrap gap-4">
                        <div>
                          <h3 className="font-bold text-slate-900 text-lg">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                          <p className="text-sm text-slate-500 mt-0.5">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà <span className="font-semibold text-blue-600">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</span> ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡πà‡∏≤‡∏ô <span className="font-semibold text-blue-600">Dropdown</span> ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                        </div>
                        <button onClick={() => exportToExcel(myApplicants, 'My_Applicants_Export')} className="flex items-center space-x-1.5 bg-emerald-50 text-emerald-700 hover:bg-emerald-600 hover:text-white border border-emerald-200 text-xs font-bold px-3 py-2 rounded-lg transition-colors shadow-sm">
                          <Download size={14} /><span>Export Excel</span>
                        </button>
                      </div>
                      <div className="overflow-x-auto">
                        <table className="w-full text-sm text-left whitespace-nowrap">
                          <thead className="bg-slate-50">
                            <tr>
                              <th className="px-6 py-3">‡∏™‡∏≤‡∏Ç‡∏≤</th>
                              <th className="px-6 py-3">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• / ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                              <th className="px-6 py-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</th>
                              <th className="px-6 py-3">‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</th>
                              <th className="px-6 py-3 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                          </thead>
                          <tbody>
                            {myApplicants.length === 0 ? (
                              <tr><td colSpan="5" className="px-6 py-8 text-center text-slate-400">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</td></tr>
                            ) : (
                              myApplicants.map(app => {
                                // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Inline ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
                                if (editAppId === app.id) {
                                  return (
                                    <tr key={app.id} className="bg-blue-50/50 shadow-inner">
                                      <td className="px-3 py-3">
                                        <div className="font-semibold text-slate-800 text-xs">{app.branchName}</div>
                                        <div className="text-[10px] text-slate-400">{app.branchCode}</div>
                                      </td>
                                      <td className="px-3 py-3 space-y-1.5">
                                        <input value={editAppForm.name} onChange={e => setEditAppForm({...editAppForm, name: e.target.value})} className="w-full text-xs font-semibold border-slate-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 shadow-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
                                        <input value={editAppForm.phone} onChange={e => setEditAppForm({...editAppForm, phone: e.target.value})} className="w-full text-xs font-semibold border-slate-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 shadow-sm" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" />
                                      </td>
                                      <td className="px-3 py-3 space-y-1.5">
                                        <select value={editAppForm.status} onChange={e => setEditAppForm({...editAppForm, status: e.target.value})} className="w-full text-xs font-semibold border-slate-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 shadow-sm">
                                          {STATUSES.map(s => <option key={s} value={s}>{s}</option>)}
                                        </select>
                                        
                                        {/* ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô */}
                                        {editAppForm.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && (
                                          <input type="date" value={editAppForm.startDate || ''} onChange={e => setEditAppForm({...editAppForm, startDate: e.target.value})} className="w-full text-xs font-semibold border-sky-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-sky-500/20 focus:border-sky-500 shadow-sm mt-1" />
                                        )}

                                        {['‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', '‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô'].includes(editAppForm.status) && (
                                          <input value={editAppForm.comment || ''} onChange={e => setEditAppForm({...editAppForm, comment: e.target.value})} className="w-full text-xs font-semibold border-orange-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 shadow-sm mt-1" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..." />
                                        )}
                                      </td>
                                      <td className="px-3 py-3">
                                        {editAppForm.resumeName ? <span className="text-xs text-slate-500 truncate max-w-[100px] block">{editAppForm.resumeName}</span> : <span className="text-xs text-slate-400">-</span>}
                                      </td>
                                      <td className="px-3 py-3 text-right whitespace-nowrap">
                                        <button onClick={saveEditApp} className="inline-flex items-center justify-center bg-emerald-100 text-emerald-700 hover:bg-emerald-600 hover:text-white px-3 py-1.5 rounded-lg text-xs font-bold transition-colors mr-2 shadow-sm"><Check size={14} className="mr-1"/>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                        <button onClick={() => setEditAppId(null)} className="inline-flex items-center justify-center bg-slate-200 text-slate-600 hover:bg-slate-300 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors shadow-sm"><X size={14} className="mr-1"/>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                      </td>
                                    </tr>
                                  );
                                }

                                // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
                                return (
                                  <tr key={app.id} className="border-t hover:bg-slate-50">
                                    <td className="px-6 py-4">
                                      <div className="font-semibold text-slate-800">{app.branchName}</div>
                                      <div className="text-xs text-slate-400">{app.branchCode}</div>
                                    </td>
                                    
                                    {/* Click to Edit Applicant */}
                                    <td className="px-6 py-4 cursor-pointer group" onClick={() => startEditApp(app)} title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                      <div className="font-bold text-slate-900 group-hover:text-blue-600 transition-colors flex items-center gap-1.5">
                                        {app.name} <Edit size={12} className="opacity-0 group-hover:opacity-100 transition-opacity text-blue-500" />
                                      </div>
                                      <div className="text-sm text-slate-600 mt-0.5">{app.position} ‚Ä¢ {app.phone}</div>
                                    </td>

                                    {/* Inline Status Dropdown */}
                                    <td className="px-6 py-4">
                                      <select
                                        value={app.status}
                                        onChange={(e) => handleInlineStatusChange(app, e.target.value)}
                                        className="status-select font-bold text-xs px-3 py-1.5 rounded-full outline-none cursor-pointer border transition-all hover:shadow-sm"
                                        style={{
                                          backgroundColor: `${STATUS_COLORS[app.status]}15`,
                                          color: STATUS_COLORS[app.status],
                                          borderColor: `${STATUS_COLORS[app.status]}30`
                                        }}
                                      >
                                        {STATUSES.map(s => <option key={s} value={s}>{s}</option>)}
                                      </select>
                                      {app.comment && <div className="text-xs text-slate-500 mt-1.5 max-w-[200px] truncate" title={app.comment}>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: {app.comment}</div>}
                                      {app.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && app.startDate && <div className="text-xs text-sky-600 mt-1.5 font-semibold" title="‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô">üìÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô: {new Date(app.startDate).toLocaleDateString('th-TH')}</div>}
                                      {app.status === '‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && app.startDate && <div className="text-[10px] text-emerald-600 mt-1 font-semibold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠: {new Date(app.startDate).toLocaleDateString('th-TH')}</div>}
                                    </td>

                                    <td className="px-6 py-4">
                                      {app.resumeBase64 ? (
                                        <div className="flex items-center space-x-2">
                                          <button onClick={() => setPreviewFile({ base64: app.resumeBase64, name: app.resumeName })} className="text-xs bg-blue-50 text-blue-600 px-2.5 py-1.5 rounded-md border border-blue-200 flex items-center hover:bg-blue-600 hover:text-white transition-colors shadow-sm cursor-pointer" title="‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á">
                                            <Eye size={12} className="mr-1.5"/> Preview
                                          </button>
                                        </div>
                                      ) : app.resumeName ? (
                                        <span className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-md border flex w-fit items-center"><Paperclip size={12} className="mr-1"/> ‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå</span>
                                      ) : (
                                        <span className="text-xs text-slate-400">-</span>
                                      )}
                                    </td>
                                    <td className="px-6 py-4 text-right">
                                      <div className="flex items-center justify-end space-x-2">
                                        <button onClick={() => startEditApp(app)} className="p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                          <Edit size={16} />
                                        </button>
                                        <button onClick={() => deleteApplicant(app.id)} className="p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
                                          <Trash2 size={16} />
                                        </button>
                                      </div>
                                    </td>
                                  </tr>
                                )
                              })
                            )}
                        </tbody></table>
                      </div>
                    </div>
                  </>
                )}

                {/* Modal: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */}
                {addingApplicantFor && (
                  <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm animate-in fade-in duration-200">
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden">
                      <div className="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-blue-600 text-white">
                        <div>
                          <h3 className="font-bold text-lg flex items-center space-x-2">
                            <UserPlus size={20} /><span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà</span>
                          </h3>
                          <p className="text-blue-100 text-sm mt-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: {addingApplicantFor.position} ‚Ä¢ {addingApplicantFor.branchName}</p>
                        </div>
                        <button onClick={() => setAddingApplicantFor(null)} className="p-2 text-blue-200 hover:bg-blue-500 hover:text-white rounded-full transition-colors"><X size={20} /></button>
                      </div>
                      <form onSubmit={handleRecruitSubmit} className="p-6 md:p-8 space-y-6 max-h-[70vh] overflow-y-auto">
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                          <div><label className="text-sm font-semibold mb-2 block">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span className="text-red-500">*</span></label><input required type="text" name="name" value={formData.name} onChange={handleInputChange} className="w-full border border-slate-300 rounded-xl px-4 py-2.5 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10"/></div>
                          <div><label className="text-sm font-semibold mb-2 block">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ <span className="text-red-500">*</span></label><input required type="tel" name="phone" value={formData.phone} onChange={handleInputChange} className="w-full border border-slate-300 rounded-xl px-4 py-2.5 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10"/></div>
                          <div className="md:col-span-2">
                            <label className="text-sm font-semibold mb-2 block">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ <span className="text-red-500">*</span></label>
                            <select required name="status" value={formData.status} onChange={handleInputChange} className="w-full border border-slate-300 rounded-xl px-4 py-2.5 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10">
                              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô --</option>
                              {STATUSES.map(s => <option key={s} value={s}>{s}</option>)}
                            </select>
                          </div>
                          
                          {/* ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô */}
                          {formData.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && (
                            <div className="md:col-span-2 bg-sky-50/50 p-5 rounded-xl border border-sky-100 animate-in fade-in duration-300">
                              <label className="text-sm font-semibold text-sky-800 mb-2 block">‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô <span className="text-red-500">*</span></label>
                              <input required type="date" name="startDate" value={formData.startDate || ''} onChange={handleInputChange} className="w-full border border-sky-200 rounded-xl px-4 py-3 outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-500/10" />
                            </div>
                          )}

                        </div>

                        {/* UPLOAD RESUME */}
                        <div>
                          <label className="text-sm font-semibold mb-2 block">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                          <div className="flex items-center space-x-2">
                             <label className="flex items-center justify-center w-full bg-white border border-slate-300 border-dashed rounded-xl px-4 py-4 hover:bg-slate-50 hover:border-blue-400 cursor-pointer transition-colors shadow-sm">
                                <Upload size={18} className="text-blue-500 mr-2" />
                                <span className="text-sm text-slate-600 font-medium">{formData.resumeName || '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå (PDF, DOC, ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)'}</span>
                                <input type="file" className="hidden" accept=".pdf,.doc,.docx,image/*" onChange={handleFileUpload} />
                             </label>
                             {formData.resumeName && (
                               <button type="button" onClick={() => setFormData(prev => ({...prev, resumeName:'', resumeBase64:''}))} className="p-4 rounded-xl bg-red-50 text-red-500 hover:bg-red-100 transition-colors">
                                 <X size={20}/>
                               </button>
                             )}
                          </div>
                        </div>

                        {['‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', '‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô'].includes(formData.status) && (
                          <div className="bg-orange-50/50 p-5 rounded-xl border border-orange-100 animate-in fade-in duration-300">
                            <label className="text-sm font-semibold text-orange-800 mb-2 block">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î <span className="text-red-500">*</span></label>
                            <textarea required name="comment" value={formData.comment} onChange={handleInputChange} rows="2" className="w-full border border-orange-200 rounded-xl px-4 py-3 outline-none focus:border-orange-400 focus:ring-4 focus:ring-orange-500/10"></textarea>
                          </div>
                        )}
                        
                        <div className="pt-6 border-t flex justify-end space-x-3">
                          <button type="button" onClick={() => setAddingApplicantFor(null)} className="px-6 py-3 rounded-xl font-semibold text-slate-600 hover:bg-slate-100 transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                          <button type="submit" className="bg-blue-600 hover:bg-blue-700 text-white py-3 px-8 rounded-xl font-semibold shadow-sm flex items-center space-x-2 transition-all active:scale-95">
                            <CheckCircle2 size={18} /><span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* --- TAB: DASHBOARD --- */}
            {activeTab === 'dashboard' && (
               <div className="space-y-8 animate-in slide-in-from-bottom-4 duration-500 pb-10">
                 <div className="bg-gradient-to-r from-slate-900 to-slate-800 p-8 rounded-3xl shadow-lg flex flex-col md:flex-row justify-between items-start md:items-center gap-6 relative overflow-hidden">
                   <div className="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white opacity-5 rounded-full blur-2xl"></div>
                   <div className="relative z-10">
                     <div className="inline-flex items-center space-x-2 bg-white/10 px-3 py-1 rounded-full text-blue-200 text-xs font-semibold mb-3 border border-white/10">
                       <span className="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></span>
                       <span>Executive Dashboard</span>
                     </div>
                     <h2 className="text-2xl md:text-3xl font-black text-white">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h2>
                     <p className="text-slate-300 mt-1">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏£‡∏´‡∏≤‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£</p>
                   </div>
                   <div className="relative z-10 w-full md:w-auto">
                     <label className="block text-xs font-bold text-slate-300 mb-2 uppercase tracking-wider">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° TA</label>
                     <div className="flex items-center space-x-3 bg-white/10 backdrop-blur-md p-1.5 rounded-2xl border border-white/20">
                       <Search size={18} className="text-slate-300 ml-3" />
                       <select value={dashboardTA} onChange={(e) => setDashboardTA(e.target.value)} className="w-full md:w-56 bg-transparent text-white py-2.5 pr-8 focus:outline-none [&>option]:text-slate-900 font-semibold cursor-pointer">
                         <option value="ALL">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (All TAs)</option>
                         {appTAs.map(ta => <option key={ta} value={ta}>{ta}</option>)}
                       </select>
                     </div>
                   </div>
                 </div>
     
                 {/* Executive KPIs */}
                 <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                   <div className="bg-white p-7 rounded-3xl border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:-translate-y-1 transition-transform">
                     <div className="flex justify-between items-start mb-4">
                       <div className="p-3 bg-blue-50 text-blue-600 rounded-2xl"><Users size={24} /></div>
                       <span className="text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded-md">Total</span>
                     </div>
                     <p className="text-sm font-bold text-slate-500 mb-1">‡∏£‡∏ß‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                     <p className="text-4xl font-black text-slate-900">{dashboardData.length} <span className="text-sm font-semibold text-slate-400">‡∏Ñ‡∏ô</span></p>
                   </div>
     
                   <div className="bg-white p-7 rounded-3xl border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:-translate-y-1 transition-transform">
                     <div className="flex justify-between items-start mb-4">
                       <div className="p-3 bg-emerald-50 text-emerald-600 rounded-2xl"><CheckCircle2 size={24} /></div>
                       <span className="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-md">
                         {dashboardData.length > 0 ? Math.round((dashboardData.filter(a=>['‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô','‡∏ú‡πà‡∏≤‡∏ô'].includes(a.status)).length / dashboardData.length) * 100) : 0}% Yield
                       </span>
                     </div>
                     <p className="text-sm font-bold text-slate-500 mb-1">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô/‡∏ú‡πà‡∏≤‡∏ô)</p>
                     <div className="flex items-baseline space-x-2">
                       <p className="text-4xl font-black text-slate-900">{dashboardData.filter(a=>['‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô','‡∏ú‡πà‡∏≤‡∏ô'].includes(a.status)).length}</p>
                     </div>
                   </div>
     
                   <div className="bg-white p-7 rounded-3xl border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:-translate-y-1 transition-transform">
                     <div className="flex justify-between items-start mb-4">
                       <div className="p-3 bg-amber-50 text-amber-600 rounded-2xl"><Clock size={24} /></div>
                       <span className="text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded-md">Pipeline</span>
                     </div>
                     <p className="text-sm font-bold text-slate-500 mb-1">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                     <p className="text-4xl font-black text-slate-900">{dashboardData.filter(a=>['‡∏£‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå','‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô','‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û'].includes(a.status)).length}</p>
                   </div>
     
                   <div className="bg-white p-7 rounded-3xl border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:-translate-y-1 transition-transform">
                     <div className="flex justify-between items-start mb-4">
                       <div className="p-3 bg-red-50 text-red-600 rounded-2xl"><AlertCircle size={24} /></div>
                       <span className="text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded-md">
                         {dashboardData.length > 0 ? Math.round((dashboardData.filter(a=>a.status === '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô').length / dashboardData.length) * 100) : 0}% Loss
                       </span>
                     </div>
                     <p className="text-sm font-bold text-slate-500 mb-1">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</p>
                     <p className="text-4xl font-black text-slate-900">{dashboardData.filter(a=>a.status === '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô').length}</p>
                   </div>
                 </div>
     
                 {/* Recruitment Pipeline Funnel & Charts */}
                 <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                   <div className="bg-white p-8 rounded-3xl border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] flex flex-col">
                     <div className="mb-6 flex items-center justify-between">
                       <div>
                         <h3 className="font-bold text-lg text-slate-900">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤ (Source)</h3>
                       </div>
                       <div className="p-2 bg-blue-50 text-blue-600 rounded-xl"><Building2 size={20} /></div>
                     </div>
                     <div className="flex-1 min-h-[300px]">
                       <ResponsiveContainer width="100%" height="100%">
                         <BarChart data={branchChartData} margin={{ top: 10, bottom: 0, left: -20, right: 10 }}>
                           <defs>
                             <linearGradient id="colorCount" x1="0" y1="0" x2="0" y2="1">
                               <stop offset="5%" stopColor="#3B82F6" stopOpacity={1}/>
                               <stop offset="95%" stopColor="#8B5CF6" stopOpacity={0.8}/>
                             </linearGradient>
                           </defs>
                           <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#F1F5F9" />
                           <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fontSize: 11, fill: '#64748B', fontWeight: 600}} dy={10} />
                           <YAxis axisLine={false} tickLine={false} tick={{fontSize: 11, fill: '#94A3B8', fontWeight: 500}} allowDecimals={false} />
                           <RechartsTooltip cursor={{ fill: '#F8FAFC' }} contentStyle={{ borderRadius: '12px', border: '1px solid #E2E8F0', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)', fontWeight: 600 }} />
                           <Bar dataKey="count" name="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Ñ‡∏ô)" fill="url(#colorCount)" radius={[6,6,0,0]} barSize={40} />
                         </BarChart>
                       </ResponsiveContainer>
                     </div>
                   </div>
     
                   <div className="bg-white p-8 rounded-3xl border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] flex flex-col">
                     <div className="mb-6 flex items-center justify-between">
                       <div>
                         <h3 className="font-bold text-lg text-slate-900">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (Status Mix)</h3>
                       </div>
                       <div className="p-2 bg-indigo-50 text-indigo-600 rounded-xl"><PieChart className="w-5 h-5" /></div>
                     </div>
                     <div className="flex-1 min-h-[300px]">
                       <ResponsiveContainer width="100%" height="100%">
                         <PieChart>
                           <Pie data={statusChartData} innerRadius={80} outerRadius={115} paddingAngle={3} dataKey="value" stroke="none">
                             {statusChartData.map((e, i) => <Cell key={i} fill={STATUS_COLORS[e.name] || '#CBD5E1'} />)}
                           </Pie>
                           <RechartsTooltip contentStyle={{ borderRadius: '12px', border: '1px solid #E2E8F0', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }} />
                           <Legend layout="vertical" align="right" verticalAlign="middle" wrapperStyle={{ fontSize: '13px', color: '#475569', fontWeight: 600 }} />
                         </PieChart>
                       </ResponsiveContainer>
                     </div>
                   </div>
                   
                   {/* ‡∏Å‡∏£‡∏≤‡∏ü SLA ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° */}
                   <div className="bg-white p-8 rounded-3xl border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] flex flex-col lg:col-span-2">
                     <div className="mb-6 flex items-center justify-between">
                       <div>
                         <h3 className="font-bold text-lg text-slate-900">‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏á (Vacancy SLA Aging)</h3>
                         <p className="text-sm text-slate-500 mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î (‡∏ß‡∏±‡∏ô)</p>
                       </div>
                       <div className="p-2 bg-rose-50 text-rose-600 rounded-xl"><Clock size={20} /></div>
                     </div>
                     <div className="flex-1 min-h-[300px]">
                       <ResponsiveContainer width="100%" height="100%">
                         <BarChart data={slaChartData} margin={{ top: 10, bottom: 0, left: -20, right: 10 }}>
                           <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#F1F5F9" />
                           <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fontSize: 12, fill: '#64748B', fontWeight: 600}} dy={10} />
                           <YAxis axisLine={false} tickLine={false} tick={{fontSize: 11, fill: '#94A3B8', fontWeight: 500}} allowDecimals={false} />
                           <RechartsTooltip cursor={{ fill: '#F8FAFC' }} contentStyle={{ borderRadius: '12px', border: '1px solid #E2E8F0', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)', fontWeight: 600 }} />
                           <Bar dataKey="count" name="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏á‡∏≤‡∏ô)" radius={[6,6,0,0]} barSize={50}>
                             {slaChartData.map((entry, index) => (
                               <Cell key={`cell-${index}`} fill={entry.fill} />
                             ))}
                           </Bar>
                         </BarChart>
                       </ResponsiveContainer>
                     </div>
                   </div>

                 </div>
               </div>
            )}

            {/* Modal: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (Master Data Upload) */}
            {showSettings && (
              <div className="fixed inset-0 z-[80] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-200">
                <div className="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden">
                  <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <h3 className="font-bold text-lg flex items-center space-x-2 text-slate-800">
                      <Settings size={20} className="text-slate-500" />
                      <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Master Data)</span>
                    </h3>
                    <button onClick={() => setShowSettings(false)} className="p-2 text-slate-400 hover:bg-slate-200 hover:text-slate-700 rounded-full transition-colors"><X size={20} /></button>
                  </div>
                  <div className="p-6 space-y-4 bg-slate-50/50">
                    <p className="text-sm text-slate-500 mb-4">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)</p>
                    
                    <label className="flex items-center justify-between w-full bg-white border border-slate-300 rounded-xl px-4 py-4 hover:border-blue-400 cursor-pointer transition-all shadow-sm group">
                      <div className="flex items-center space-x-3">
                        <div className="p-2 bg-blue-50 text-blue-600 rounded-lg group-hover:bg-blue-100 transition-colors"><MapPin size={20} /></div>
                        <div className="text-left">
                          <span className="block text-sm font-bold text-slate-700">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≤‡∏Ç‡∏≤ (StoreList)</span>
                          <span className="block text-xs text-slate-500">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡∏£‡∏´‡∏±‡∏™, ‡∏ä‡∏∑‡πà‡∏≠, Area</span>
                        </div>
                      </div>
                      <Upload size={18} className="text-slate-400 group-hover:text-blue-500 transition-colors" />
                      <input type="file" accept=".csv" className="hidden" onChange={(e) => { handleImportCSV(e); setShowSettings(false); }} />
                    </label>

                    <label className="flex items-center justify-between w-full bg-white border border-slate-300 rounded-xl px-4 py-4 hover:border-blue-400 cursor-pointer transition-all shadow-sm group">
                      <div className="flex items-center space-x-3">
                        <div className="p-2 bg-indigo-50 text-indigo-600 rounded-lg group-hover:bg-indigo-100 transition-colors"><Briefcase size={20} /></div>
                        <div className="text-left">
                          <span className="block text-sm font-bold text-slate-700">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á-Recruit</span>
                          <span className="block text-xs text-slate-500">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á, TA, Area (‡πÄ‡∏ß‡πâ‡∏ô‡πÑ‡∏î‡πâ)</span>
                        </div>
                      </div>
                      <Upload size={18} className="text-slate-400 group-hover:text-indigo-500 transition-colors" />
                      <input type="file" accept=".csv" className="hidden" onChange={(e) => { handleImportPositionCSV(e); setShowSettings(false); }} />
                    </label>

                    <label className="flex items-center justify-between w-full bg-white border border-slate-300 rounded-xl px-4 py-4 hover:border-blue-400 cursor-pointer transition-all shadow-sm group">
                      <div className="flex items-center space-x-3">
                        <div className="p-2 bg-emerald-50 text-emerald-600 rounded-lg group-hover:bg-emerald-100 transition-colors"><Users size={20} /></div>
                        <div className="text-left">
                          <span className="block text-sm font-bold text-slate-700">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ TA</span>
                          <span className="block text-xs text-slate-500">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ TA ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A</span>
                        </div>
                      </div>
                      <Upload size={18} className="text-slate-400 group-hover:text-emerald-500 transition-colors" />
                      <input type="file" accept=".csv" className="hidden" onChange={(e) => { handleImportTACSV(e); setShowSettings(false); }} />
                    </label>
                  </div>
                </div>
              </div>
            )}
            
            {/* Modal: View Applicants (Popup ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á Area HR) */}
            {viewApplicants && (
               <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm animate-in fade-in duration-200">
                 <div className="bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden">
                   <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                     <div>
                       <h3 className="font-bold text-lg text-slate-900">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: {viewApplicants.position}</h3>
                       <p className="text-sm text-slate-500">{viewApplicants.branchName}</p>
                     </div>
                     <button onClick={() => setViewApplicants(null)} className="p-2 text-slate-400 hover:bg-slate-200 rounded-full transition-colors"><X size={20} /></button>
                   </div>
                   <div className="p-6 max-h-[60vh] overflow-y-auto">
                     <div className="space-y-3">
                       {viewApplicants.list.map(app => (
                         <div key={app.id} className="p-4 rounded-xl border border-slate-100 flex justify-between items-center hover:border-blue-200 transition-colors">
                           <div className="flex items-start space-x-3">
                             <div className="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 font-bold shrink-0">{app.name.charAt(0)}</div>
                             <div>
                               <p className="font-bold text-slate-900">{app.name}</p>
                               <div className="flex flex-wrap items-center gap-2 mt-1">
                                 <p className="text-sm text-slate-500 flex items-center"><Phone size={12} className="mr-1"/> {app.phone}</p>
                                 
                                 {app.resumeBase64 && (
                                   <button 
                                     onClick={() => setPreviewFile({ base64: app.resumeBase64, name: app.resumeName })}
                                     className="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-md border border-blue-200 flex items-center hover:bg-blue-600 hover:text-white transition-colors"
                                     title="‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà"
                                   >
                                     <Eye size={12} className="mr-1"/> ‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà
                                   </button>
                                 )}
                               </div>
                             </div>
                           </div>
                           <div className="text-right shrink-0">
                             <span className="inline-block px-2.5 py-1 rounded-full text-xs font-bold" style={{ backgroundColor: `${STATUS_COLORS[app.status]}15`, color: STATUS_COLORS[app.status] }}>{app.status}</span>
                             {app.status === '‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && app.startDate && <div className="text-[10px] text-sky-600 mt-1 font-semibold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô: {new Date(app.startDate).toLocaleDateString('th-TH')}</div>}
                             {app.status === '‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' && app.startDate && <div className="text-[10px] text-emerald-600 mt-1 font-semibold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: {new Date(app.startDate).toLocaleDateString('th-TH')}</div>}
                             <p className="text-[10px] text-slate-400 mt-1">‡πÇ‡∏î‡∏¢ {app.ta}</p>
                           </div>
                         </div>
                       ))}
                     </div>
                   </div>
                 </div>
               </div>
             )}

            {/* Modal: Preview File (‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà) */}
            {previewFile && (
              <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-200">
                <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-[85vh] flex flex-col overflow-hidden">
                  <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                    <div>
                      <h3 className="font-bold text-lg text-slate-900 flex items-center space-x-2">
                        <Eye size={20} className="text-blue-500" />
                        <span>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
                      </h3>
                      <p className="text-sm text-slate-500 mt-0.5">{previewFile.name}</p>
                    </div>
                    <div className="flex items-center space-x-2">
                      <a 
                        href={previewFile.base64} 
                        download={previewFile.name} 
                        className="flex items-center space-x-1.5 px-4 py-2 bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white rounded-xl transition-colors font-semibold shadow-sm text-sm"
                      >
                        <Download size={16} /><span>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span>
                      </a>
                      <button onClick={() => setPreviewFile(null)} className="p-2 text-slate-400 hover:bg-slate-200 hover:text-slate-700 rounded-full transition-colors"><X size={20} /></button>
                    </div>
                  </div>
                  
                  <div className="flex-1 bg-slate-100 p-4 sm:p-6 flex items-center justify-center overflow-hidden">
                    {previewFile.base64.startsWith('data:application/pdf') || previewFile.base64.startsWith('data:image/') ? (
                      <iframe 
                        src={previewFile.base64} 
                        className="w-full h-full rounded-xl border border-slate-200 shadow-sm bg-white" 
                        title="File Preview"
                      ></iframe>
                    ) : (
                      <div className="text-center bg-white p-12 rounded-2xl shadow-sm border border-slate-200 max-w-sm">
                        <div className="w-20 h-20 bg-orange-50 rounded-full flex items-center justify-center mx-auto mb-6">
                          <FileText size={40} className="text-orange-400" />
                        </div>
                        <p className="text-lg font-bold text-slate-800 mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ</p>
                        <p className="text-sm text-slate-500 mb-6">‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Word (doc, docx) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö</p>
                        <a 
                          href={previewFile.base64} 
                          download={previewFile.name} 
                          className="inline-flex items-center justify-center space-x-2 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors font-semibold shadow-sm w-full"
                        >
                          <Download size={18} /><span>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span>
                        </a>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}

          </main>
        </div>
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
